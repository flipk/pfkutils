
LIB= libpkthr.a
CPPFLAGS= -Ih -Iint -I.. -I../dll2 -I../util -I../h
GCC= gcc $(CPPFLAGS) -O3
GCCLINK= g++ $(CPPFLAGS) $(LINKFL)
SRCS=  pk_messages.C pk_semaphores.C pk_threads.C pk_timers.C stringhash.C \
	pk_filedescs.C pk_filedescs_thread.C
HDRS= h/pk_messages.H h/pk_semaphores.H h/pk_threads.H \
	h/pk_timers.H h/stringhash.H int/pk_messages_internal.H \
	int/pk_threads_internal.H int/pk_timers_internal.H

OBJS= $(SRCS:.C=.o)

LINKFL= -lpthread

#ifdef solaris
CPPFLAGS+= -DSOLARIS
LINKFL+= -lsocket -lrt
#elifdef sunos
CPPFLAGS+= -DSUNOS
#elifdef cygwin32
CPPFLAGS+= -DCYGWIN
#elifdef linux
CPPFLAGS+= -DLINUX -Wall -Werror
LINKFL+= -lrt
#else
#  ?
#endif

all: $(LIB) t1 t2

$(LIB): $(OBJS)
	rm -f $(LIB)
	ar cq $(LIB) $(OBJS)
	ranlib $(LIB)

t1: $(LIB) test-1.C
	$(GCCLINK) -g3 test-1.C -Ih $(LIB) ../dll2/libdll2.a -o t1

t2: $(LIB) test-2.C
	$(GCCLINK) -g3 test-2.C -Ih $(LIB) ../dll2/libdll2.a -o t2

.C.o:
	$(GCC) -c $*.C

depend: Makefile.in $(SRCS) $(HDRS)
	awk 'BEGIN { copy=1; } { if ( copy ) print } /^#DEPENDENCIES/ { copy=0; }' < Makefile > x
	gcc -M $(CPPFLAGS) $(SRCS) >> x
	mv x Makefile

clean:
	rm -f xmakefile $(LIB) *.core  *.o *~
	rm -f Makefile t1 t2

#DEPENDENCIES
